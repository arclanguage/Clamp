(in-package :clamp-tests)
(use-syntax :clamp)

(defsuite sort (clamp))

(deftest compare (sort)
  (assert-true  (call (compare #'< #'len) '(1 2) '(1 2 3)))
  (assert-false (call (compare #'< #'len) '(1 2 3) '(1 2 3))))

(deftest best (sort)
  (assert-eql 5 (best #'< '(10 9 5 7 8)))
  (assert-eql 11 (best #'> '(10 9 5 7 11 4)))
  (assert-equal '(1 2) (best #'< '((1 2 3) (4 5 6) (1 2)) #'len))
  (assert-equal '(1 2 3) (best #'> '((1 2 3) (4 5) (1 2)) #'len)))

(deftest bestn (sort)
  (assert-equal '(1 2 3) (bestn 3 #'< '(6 1 3 5 9 2 6)))
  (assert-equal '(6 5 4) (bestn 3 #'> '(1 5 4 3 2 6)))
  (assert-equal '(() (1)) (bestn 2 #'< '((1 2) () (1 2 3) (1)) #'len))
  (assert-equal '(1 2 3) (bestn 3 #'< #(6 1 3 5 9 2 6)))
  (assert-equal '(6 5 4) (bestn 3 #'> #(1 5 4 3 2 6)))
  (assert-equal '(() (1)) (bestn 2 #'< #((1 2) () (1 2 3) (1)) #'len)))

(deftest sort (sort)
  (assert-equal '(1 2 3) (sort #'< '(3 1 2)))
  (assert-equal '(1 2 3 4 5 6) (sort #'< '(5 2 3 4 1 6)))
  (assert-equal '(() (1) (1 2)) (sort #'< '((1 2) () (1)) #'len))
  (assert-equalp #(1 2 3) (sort #'< #(3 1 2)))
  (assert-equalp #(1 2 3 4 5 6) (sort #'< #(5 2 3 4 1 6)))
  (assert-equalp #(() (1) (1 2)) (sort #'< #((1 2) () (1)) #'len)))

(deftest nsort (sort)
  (assert-equal '(1 2 3) (nsort #'< (list 3 1 2)))
  (assert-equal '(1 2 3 4 5 6) (nsort #'< (list 5 2 3 4 1 6)))
  (assert-equal '(() (1) (1 2)) (nsort #'< (list '(1 2) '() '(1)) #'len))
  (assert-equalp #(1 2 3) (nsort #'< (vector 3 1 2)))
  (assert-equalp #(1 2 3 4 5 6) (nsort #'< (vector 5 2 3 4 1 6)))
  (assert-equalp #(() (1) (1 2)) (nsort #'< (vector '(1 2) '() '(1)) #'len)))

(deftest med (sort)
  (assert-eql 2 (med #'< '(1 3 2)))
  (assert-eql 2 (med #'< '(4 3 1 2)))
  (assert-eql 3 (med #'< '(3 5 4 1 2)))
  (assert-eql 3 (med #'< '(5 3 6 2 1 4)))
  (assert-equalp "def" (med #'string< '("def" "ghi" "abc")))
  (assert-equal '(1) (med #'< '((1 2 3) () (1) (1 2)) #'len)))
